<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººæˆç¸¾ | å‚äº•éº»é›€åº—</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title">å‚äº•éº»é›€åº—</h1>
            <p class="site-subtitle">Sakai Mahjong Club</p>
        </div>
    </header>

    <div class="container">
        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>
        <h1 class="page-title">âš¡ å€‹äººæˆç¸¾</h1>

        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ -->
        <div class="section">
            <div class="stats-player-select">
                <label for="player-select">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸æŠ:</label>
                <select id="player-select">
                    <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
            </div>
        </div>

        <!-- ã‚¹ã‚¿ãƒƒãƒ„è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="stats-container"></div>

        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ -->
        <div class="section">
            <div class="section-header">
                <span>ğŸ“Š</span>
                <span>ç·åˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>
            </div>
            <table class="record-table">
                <thead>
                    <tr>
                        <th>é †ä½</th>
                        <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</th>
                        <th>å¯¾å±€æ•°</th>
                        <th>å¹³å‡ç€é †</th>
                        <th>é€£å¯¾ç‡</th>
                        <th>ãƒ©ã‚¹å›é¿</th>
                    </tr>
                </thead>
                <tbody id="ranking-body"></tbody>
            </table>
        </div>

        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>
    </div>

    <script src="js/main.js"></script>
    <script src="js/playerStats.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('data/stats-total.json');
            const data = await response.json();
            const players = data.players;

            // å¯¾å±€æ•°ãŒ1ä»¥ä¸Šã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ã—ã¦ã‚½ãƒ¼ãƒˆ
            const activePlayers = Object.entries(players)
                .filter(([_, stats]) => stats.summary.games > 0)
                .sort((a, b) => a[1].summary.avgRank - b[1].summary.avgRank);

            // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ç”Ÿæˆ
            const select = document.getElementById('player-select');
            activePlayers.forEach(([name, _]) => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });

            // é¸æŠæ™‚ã«ã‚¹ã‚¿ãƒƒãƒ„ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
            const container = document.getElementById('stats-container');
            select.addEventListener('change', function() {
                const selectedName = this.value;
                if (selectedName && players[selectedName]) {
                    container.innerHTML = statsRenderer.renderStatsCard(selectedName, players[selectedName]);
                } else {
                    container.innerHTML = '';
                }
            });

            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç”Ÿæˆ
            const tbody = document.getElementById('ranking-body');
            activePlayers.forEach(([name, stats], index) => {
                const rank = index + 1;
                const s = stats.summary;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="${rankClass}">${rank}ä½</td>
                    <td>${name}</td>
                    <td>${s.games}</td>
                    <td>${s.avgRank.toFixed(2)}</td>
                    <td>${s.rates.top2.toFixed(1)}%</td>
                    <td>${s.rates.avoid4th.toFixed(1)}%</td>
                `;
                row.style.cursor = 'pointer';
                row.addEventListener('click', () => {
                    select.value = name;
                    select.dispatchEvent(new Event('change'));
                    container.scrollIntoView({ behavior: 'smooth' });
                });
                tbody.appendChild(row);
            });

            // æœ€åˆã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è‡ªå‹•é¸æŠ
            if (activePlayers.length > 0) {
                select.value = activePlayers[0][0];
                select.dispatchEvent(new Event('change'));
            }

        } catch (err) {
            console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', err);
        }
    });
    </script>
</body>
</html>
